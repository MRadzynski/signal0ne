---
name: ErrorRateByService
lookback: 15m
steps:
- name: Receive alert from Prometheus Alertmanager
  action: receive_alert
  integration: webhook
  config:
    mappings:
      job: service
      span_name: span
      startsAt: timestamp
- name: Get ownership
  action: get_ownership
  integration: backstage
  config:
    filter: kind=component,metadata.name={service}
    enrichments:
    - spec.owner
    - metadata.labels.slack_channel
- name: Get relevant logs
  action: get_relevant_logs
  integration: opensearch
  config:
    mappings:
      severity: severity.text
      service: resource.service.name
      timestamp: observedTimestamp
    enrichments:
    - body
    - resource:host.name
- name: Inspect traces
  action: inspect_traces
  integration: jeager
  config:
    tags:
      error: 'true'
    desired_enrichments:
    - logs
    conditions:
    - if_empty: additional_context.occured_error_logs
- name: Correlate alerts
  action: similarity_search
  integration: signal0ne
  config:
    desired_enrichments:
    - alerts-ongoing
- name: Summarize context
  action: summarize
  integration: openai
  config: {}
- name: Send to slack channel
  action: send_to_slack
  integration: slack
  config:
    mappings:
      channel: metadata.labels.slack_channel
    ingore_context_keys:
    - metadata.labels.slack_channel
